@using System.Globalization

<div class="chart-container" style="height: 200px; position: relative;">
    <svg viewBox="0 0 100 50" preserveAspectRatio="none" style="width: 100%; height: 100%;">
        <!-- Grid lines -->
        <line x1="0" y1="40" x2="100" y2="40" stroke="#e0e0e0" stroke-width="0.5" />
        <line x1="0" y1="25" x2="100" y2="25" stroke="#e0e0e0" stroke-width="0.5" />
        <line x1="0" y1="10" x2="100" y2="10" stroke="#e0e0e0" stroke-width="0.5" />

        <!-- Path -->
        <polyline fill="none" stroke="#0d6efd" stroke-width="1.5" points="@Points" />
        
        <!-- Dots -->
        @foreach(var point in Dots)
        {
            <circle cx="@point.X" cy="@point.Y" r="1.5" fill="#0d6efd" />
        }
    </svg>
</div>
<div class="d-flex justify-content-between mt-2 text-muted small">
    @foreach(var label in Labels)
    {
        <span>@label</span>
    }
</div>

@code {
    [Parameter] public IEnumerable<(string Label, decimal Value)> Data { get; set; } = Enumerable.Empty<(string, decimal)>();

    private string Points
    {
        get
        {
            if (!Data.Any()) return "";
            
            var list = Data.ToList();
            var max = list.Max(d => d.Value) * 1.1m;
            if (max == 0) max = 1;

            var points = new List<string>();
            decimal stepX = 100m / (list.Count - 1 > 0 ? list.Count - 1 : 1);

            for (int i = 0; i < list.Count; i++)
            {
                var x = i * stepX;
                var y = 50 - (list[i].Value / max * 50);
                points.Add($"{x.ToString(CultureInfo.InvariantCulture)},{y.ToString(CultureInfo.InvariantCulture)}");
            }
            return string.Join(" ", points);
        }
    }
    
    private List<(string X, string Y)> Dots
    {
        get
        {
            if (!Data.Any()) return new();

            var list = Data.ToList();
            var max = list.Max(d => d.Value) * 1.1m;
            if (max == 0) max = 1;
            
            var dots = new List<(string, string)>();
            decimal stepX = 100m / (list.Count - 1 > 0 ? list.Count - 1 : 1);

             for (int i = 0; i < list.Count; i++)
            {
                var x = i * stepX;
                var y = 50 - (list[i].Value / max * 50);
                dots.Add((x.ToString(CultureInfo.InvariantCulture), y.ToString(CultureInfo.InvariantCulture)));
            }
            return dots;
        }
    }

    private IEnumerable<string> Labels => Data.Select(x => x.Label);
}
